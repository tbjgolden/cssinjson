!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).nCSS={})}(this,function(e){"use strict";const n=/\{(\^*)([0-9a-z]+)\}/i,t=/&/g;function r(e,n){return(typeof e)[0]===(n=n||"s")}function o(e){return r(e[0])&&r(e[1])}function c(e){return e.reduce((e,n)=>e.concat(n),[])}function u(e){return Array.isArray(e)?e:[e]}function f(e,n){return function(e){return r(e[0])&&Array.isArray(e[1])&&e[1].every(o)}(e)?[e]:c(e.map(e=>f(e)))}function i(e,n){n=n||{};for(let t in e){const o=e[t];n[t]=n[t]||(o&&r(o,"o")?i(o.constructor(),o):o)}return n}function a(e,o,c){if((o=o||{})._=o._||[],c=!r(c,"b")||c,Array.isArray(e))return e.map(e=>a(e,o,!1));let u=(e+="").match(n);for(;u;){const t=o._.length-u[1].length-1,c=parseInt(u[2]),f=c==c&&t>=0?c:u[2];u=(e=e.replace(u[0],(r(f,"n")?o._[t]:o)[f])).match(n)}if(c&&o._.length){const n=o._[o._.length-1][0];return~e.indexOf("&")?e.replace(t,n):`${n}${e}`}return e}function s(e){return e.map(e=>`${e[0]} { ${e[1].map(e=>`${e[0]}: ${e[1]}`).join("; ")} }`).join("\n")}function l(e,n,t){(n=n||{})._=n._||[],t=!r(t,"b")||t,r(e)&&(e=JSON.parse(e));let s=[];if(Array.isArray(e)){if(r(e[0]))return a(e,n);for(let t=0;t<e.length;t++)s[t]=l(e[t],n,!1)}else if(e.$){const t=[],r={};for(let f=0;f<e.$.length;f++){const s=a(e.$[f][0],n),p=i(n,{_:n._.concat([e.$[f]])}),y=l(u(e._),p,!1).reduce((e,n)=>(e[~~o(n)].push(n),e),[[],[]]);t.push.apply(t,c(y[0])),y[1].length&&(r[s]=(r[s]||[]).concat(y[1]))}s=Object.entries(r).concat(t)}else{let t=[n];Object.keys(e).forEach(n=>{"_"!==n&&(t=c(e[n].map(e=>t.map(t=>((t=i(t))[n]=e,t)))))});for(let n=0;n<t.length;n++)s[n]=l(u(e._),t[n],!1)}return t?f(s):s}e.deepClone=i,e.default=function(e,n,t){return s(l(e,n,t))},e.flatten=l,e.generate=s,e.inject=a,Object.defineProperty(e,"__esModule",{value:!0})});
