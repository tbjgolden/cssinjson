!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).nCSS={})}(this,function(e){"use strict";const t=/\{(\^*)([0-9a-z])\}/i,n=/&/g,r=(e,t)=>typeof e===(t=t||"string"),o=e=>r(e[0])&&r(e[1]),c=e=>(e=>r(e[0])&&Array.isArray(e[1])&&e[1].every(o))(e)?[e]:e.map(c).reduce((e,t)=>e.concat(t),[]);function a(e,t){t=t||{};for(let n in e){const o=e[n];t[n]=t[n]||(o&&r(o,"object")?a(o.constructor(),o):o)}return t}function f(e,o,c=!0){if(Array.isArray(e))return e.map(e=>f(e,o,!1));let a=(e+="").match(t);for(;a;){const n=o._.length-a[1].length-1,c=parseInt(a[2])||a[2];a=(e=e.replace(a[0],(r(c,"number")?o._[n]:o)[c])).match(t)}if(c&&o._){const t=o._[o._.length-1][0];return~e.indexOf("&")?e.replace(n,t):`${t}${e}`}return e}function u(e){return e.map(e=>`${e[0]} { ${e[1].map(e=>`${e[0]}: ${e[1]}`).join("; ")} }`).join("\n")}function i(e,t={},n=!0){r(e)&&(e=JSON.parse(e));let u=[];if(Array.isArray(e)){if(r(e[0]))return f(e,t);for(let n=0;n<e.length;n++)u[n]=i(e[n],t,!1)}else if(e.$){const n=[],r={};for(let c=0;c<e.$.length;c++){const u=f(e.$[c][0],t),s=a(t,{_:(t._||[]).concat([e.$[c]])}),l=i(e._,s,!1).reduce((e,t)=>(e[~~o(t)].push(t),e),[[],[]]);n.push.apply(n,l[0].reduce((e,t)=>e.concat(t),[])),l[1].length&&(r[u]=(r[u]||[]).concat(l[1]))}u=Object.entries(r).concat(n)}else{let n=[t];Object.keys(e).forEach(t=>{"_"!==t&&(e[t].forEach(e=>{n.map(n=>((n=a(n))[t]=e,n))}),n=e[t].map(e=>n.map(n=>((n=a(n))[t]=e,n))).reduce((e,t)=>e.concat(t),[]))});for(let t=n.length-1;t>=0;t--)u[t]=i(e._,n[t],!1)}return n?c(u):u}e.deepClone=a,e.default=function(e,t={},n=!0){return u(i(e,t,n))},e.flatRulesToCSS=u,e.inject=f,e.sourceToFlatRules=i,Object.defineProperty(e,"__esModule",{value:!0})});
